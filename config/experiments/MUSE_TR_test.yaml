title: MUSE_Treatment_Response
project_dir: '/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/results'
seed: 44

wandb:
  mode: online

data_loader:

  missing_modalities_tables: 
    active: True #False se vogliamo testare il caso completo
    # missing_mod_rate: genomics_miss_25 #genomics/wsi rates: 0, 0.25, 0.5, 0.75
    # missing_mod_rate: missing_all_30 #rates: 0.3, 0.6 di cui metà per ogni modalità
    missing_mod_rate: complete

  file_genes_group: "/work/H2020DeciderFicarra/D2_4/datasets/DECIDER_cohorts/Gene_expression/Expression/daria_mapped_all_genes.json"
  datasets_configs: ["/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/datasets/Decider_dataset_TR_chemorefractory_all_tissues.yaml","/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/datasets/TR_PTRC-HGSOC_all_tissues.yaml","/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/datasets/TR_OBR_expandedv2_all_tissues.yaml"]
  #file_genes_group: "/work/H2020DeciderFicarra/D2_4/datasets/DECIDER_cohorts/Gene_expression/Expression/daria_mapped.json"
  # file_genes_group: "/work/H2020DeciderFicarra/D2_4/Development/HGCN/HGCN_code/pathways_ensg.json"
  # datasets_configs: ["/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/datasets/TCGA_BRCA_dataset.yaml"]
  task_type: "Treatment_Response"
  max_patches: 4096
  batch_size: 1
  real_batch_size: 4
  n_bins: 4
  sample: True
  test_sample: False
  load_slides_in_RAM: True  
  label_name: "Treatment_Response"
  censorships_name: "None"
  eps: 0.000001
  num_workers: 2
  train_size: 0.7
  val_size: 0.0
  test_size: 0.15
  random_state: 42
  preprocessing: /work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/preprocessing.yaml
  augmentation: /work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/config/augmentation.yaml
  KFold:
    splits: /work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/splits/Treatment_Response/T_PTRC-HGSOC_chemorefractory_OBR_expandedv2_V_chemorefractory/k_5/all_tissues
    internal_val_size: 0.0

log_on_telegram: False

missing_modality_test:
  active: True
  test_scenarios_on_each_epoch: True
  scenarios: [
    "complete",
    "missing_all_30",
    "missing_all_60",
    "genomics_miss_100",
    "wsi_miss_100",
    "genomics_miss_25",
    "genomics_miss_50",
    "genomics_miss_75"
# 'genomics_miss_25',
    # 'missing_all_60'
  ]  #questi sono gli scenari che voglio testare in test addizionali al test (quindi il caso di train viene testato in ogni caso, e poi vengono aggiunte anche queste prove)

model:
  name: MUSE
  pretrained: False # False # True
  save_checkpoints: False
  kwargs:
    embedding_size: 128
    dropout: 0.25
    ffn_layers: 2
    gnn_layers: 2
    output_size: 2

    genomics_group_name: ["all_genes"]
    genomics_group_dropout: [0.35]

    input_modalities: ["WSI", "Genomics"]
    cnv_group_name: ["all_genes"]
  device: cuda

loss:
  name: CrossEntropyLoss
  kwargs:
    label_smoothing: 0.0
    reduction: 'mean'
    weight: [2, 1]


scheduler:
  batch_step: False
  name: MultiStepLR
  milestones: [10]
  gamma: 0.2
  pct_start: 0.1
  steps_per_epoch: 1

optimizer:
  learning_rate: 0.0001
  name: RAdam
  weight_decay: 0.0001 # 0 # 0.00005
  momentum: None

trainer:
  reload: False
  checkpoint: '/work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/results/MUSE_Treatment_Response_YY2025-MM06-DD20-HH12-MM59_8831B7A33C'
  do_train: False
  do_test: True
  do_inference: False
  do_kfold: False
  epochs: 100
  patience: 7
  AEM_lamda: 0
  Save_XA_attention_files: False
  grid_search_versions_path: /work/H2020DeciderFicarra/D2_4/Development/MultimodalDecider/grid_search/models_versions